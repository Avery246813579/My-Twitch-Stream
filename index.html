<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Twitch Stream</title>
</head>
<body>

<a href="https://api.twitch.tv/kraken/oauth2/authorize?response_type=code&client_id=gxf6yv4dro02sb5m0tc9jmb3wak4vk&redirect_uri=https://avery246813579.github.io/My-Twitch-Stream/twitch.html&scope=user_read">Login</a>

<script>
    function sendSimpleRequest(route, method, body, payback) {
        var request = new XMLHttpRequest();

        if (window.location.href.indexOf('localhost:8081') > -1) {
            request.open(method.toUpperCase(), "https://api.twitch.tv/kraken/" + route);

            request.setRequestHeader("Content-type", "application/json");
            request.setRequestHeader('Client-ID', "gxf6yv4dro02sb5m0tc9jmb3wak4vk");

            if (typeof body == "undefined" || body == null) {
                try {
                    request.send();
                } catch (Exception) {

                }
            } else {
                request.send(JSON.stringify(body));
            }

            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (request.status === 200) {
                        var response = JSON.parse(request.responseText);

                        payback(undefined, response);
                    } else {
                        console.log(request.statusText)
                    }
                }
            }
        } else if ("withCredentials" in request) {

            // Check if the XMLHttpRequest object has a "withCredentials" property.
            // "withCredentials" only exists on XMLHTTPRequest2 objects.

            request.open(method, "https://api.twitch.tv/kraken/" + route, true);
            request.setRequestHeader("Content-type", "application/json");
            request.setRequestHeader('Client-ID', "gxf6yv4dro02sb5m0tc9jmb3wak4vk");
            request.withCredentials = true;

            if (typeof body == "undefined" || body == null) {
                try {
                    request.send();
                } catch (Exception) {
                    payback(Exception);
                }
            } else {
                request.send(JSON.stringify(body));
            }

            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (request.status === 200) {
                        var response = JSON.parse(request.responseText);

                        payback(undefined, response);
                    } else {
                        console.log(request.statusText)
                    }
                }
            }
        } else if (typeof XDomainRequest != "undefined") {

            // Otherwise, check if XDomainRequest.
            // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
            request = new XDomainRequest();

            request.open(method, "https://api.twitch.tv/kraken/" + route);
            request.setRequestHeader("Content-type", "application/json");
            request.setRequestHeader('Client-ID', "gxf6yv4dro02sb5m0tc9jmb3wak4vk");

            if (typeof body == "undefined" || body == null) {
                try {
                    request.send();
                } catch (Exception) {
                    payback(Exception);
                }
            } else {
                request.send(JSON.stringify(body));
            }

            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (request.status === 200) {
                        var response = JSON.parse(request.responseText);

                        payback(undefined, response);
                    } else {
                        console.log(request.statusText)
                    }
                }
            }
        } else {
            payback("We can't CORS", response);
            request = null;
        }
    }

    if(typeof localStorage.code != "undefined"){
        sendSimpleRequest('channels/test_channel', 'GET', {client_id: "gxf6yv4dro02sb5m0tc9jmb3wak4vk", client_secret: "fyz6v6ycwm393q3v23bwaejlyg31su", grant_type: "authorization_code", redirect_uri: "https://avery246813579.github.io/My-Twitch-Stream/twitch.html", code: localStorage.code}, function(err, payload){
            if(err){
                console.dir(err);
            }

            console.dir(payload);
        })
    }
</script>

</body>
</html>